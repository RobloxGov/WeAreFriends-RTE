<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ตารางเรียนและสอบ 1/2568</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h2>ดูตารางเรียน/สอบ</h2>
  <label for="typeSelect">เลือกตาราง:</label>
  <select id="typeSelect">
    <option value="เรียน 1/2568">เรียน 1/2568</option>
    <option value="สอบ 1/2568">สอบ 1/2568</option>
  </select>

  <div id="tableContainer"></div>

  <script>
    const url = 'https://script.google.com/macros/s/AKfycbzOY_kwIkpO9yvjDfzf-OKOyFr_FNrVi5YAxlBTPFax1Mybv0b_1Ew00qYvZZUcXEyI/exec';

    async function loadData() {
      const res = await fetch(url);
      const data = await res.json();

      const select = document.getElementById('typeSelect');
      select.addEventListener('change', () => renderTable(data, select.value));

      renderTable(data, select.value);
    }

    function parseDate(item) {
      const monthMap = {
        'มกราคม': 0, 'กุมภาพันธ์': 1, 'มีนาคม': 2, 'เมษายน': 3,
        'พฤษภาคม': 4, 'มิถุนายน': 5, 'กรกฎาคม': 6, 'สิงหาคม': 7,
        'กันยายน': 8, 'ตุลาคม': 9, 'พฤศจิกายน': 10, 'ธันวาคม': 11
      };
      const year = item.ปี - 543;
      const month = monthMap[item.เดือน];
      const day = item.วันที่;
      const [hour, minute] = item["เวลาเริ่ม"].split(":").map(Number);
      return new Date(year, month, day, hour, minute);
    }

    function renderTable(data, type) {
      const container = document.getElementById('tableContainer');
      const items = [...data[type]];

      // เรียงลำดับตามวัน/เดือน/ปี และเวลาเริ่ม
      items.sort((a, b) => parseDate(a) - parseDate(b));

      if (items.length === 0) {
        container.innerHTML = "<p>ไม่มีข้อมูล</p>";
        return;
      }

      // สร้างหัวตารางจากคีย์
      const headers = Object.keys(items[0]);

      const tableHTML = `
        <table>
          <thead>
            <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
          </thead>
          <tbody>
            ${items.map(row => `
              <tr>${headers.map(h => `<td>${(row[h] || '').replace(/\r?\n/g, "<br>")}</td>`).join('')}</tr>
            `).join('')}
          </tbody>
        </table>
      `;

      container.innerHTML = tableHTML;
    }

    loadData();
  </script>
</body>
</html>
