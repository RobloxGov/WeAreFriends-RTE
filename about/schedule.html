<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }
        
        body {
            overflow-x: hidden;
        }
        
        select#type {
            width: 100%;
        }

        button#sortByMonth {
            display: none;
        }

        select,
        table {
            margin-top: 20px;
            font-size: 16px;
        }

        .scroll-wrapper {
          overflow-x: auto;
          overflow-y: hidden;
        }
    
        .scroll-sync {
          height: 1px;
        }
    
        .table-wrapper {
          overflow-x: auto;
          max-width: 100%;
        }


        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #ffd8bf;
        }
        
        .container {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: 15px;
            padding-right: 15px;
        }
        
        @media (min-width: 576px) {
            .container {
                max-width: 540px;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
        }
        
        @media (min-width: 992px) {
            .container {
                max-width: 960px;
            }
        }
        
        @media (min-width: 1200px) {
            .container {
                max-width: 1140px;
            }
        }
        
        @media (min-width: 1400px) {
            .container {
                max-width: 1320px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
        	<img src="/img/kmitl.svg"> KMITL <img src="/img/rte.webp"> RTE
        </div>
        <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
        <nav class="nav nav-menu">
            <a href="/">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
            <a href="">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö</a>
            <a href="/contact/">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</a>
        </nav>
    </header>
    <main class="container" style=" margin-top: 70px; ">
      <h1>üìò ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö</h1>
    
      <label for="type">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</label>
      <select id="type">
        <option value="‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1/2568">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
        <option value="‡∏™‡∏≠‡∏ö 1/2568">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ö</option>
      </select>
    
      <button id="sortByMonth">üîÅ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
        
      <div class="scroll-wrapper" id="top-scroll">
        <div class="scroll-sync" style="width: 2000px;"></div> <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö table -->
      </div>
        
      <div class="table-wrapper" id="bottom-scroll">
          <table id="data-table"></table>
      </div>
    </main>
  <script>
    const topScroll = document.getElementById('top-scroll');
    const bottomScroll = document.getElementById('bottom-scroll');

    topScroll.addEventListener('scroll', () => {
      bottomScroll.scrollLeft = topScroll.scrollLeft;
    });

    bottomScroll.addEventListener('scroll', () => {
      topScroll.scrollLeft = bottomScroll.scrollLeft;
    });

    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á scroll-sync ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á table ‡∏à‡∏£‡∏¥‡∏á
    const sync = document.querySelector('.scroll-sync');
    const table = document.getElementById('data-table');
    sync.style.width = table.scrollWidth + 'px';
  </script>
  
  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzOY_kwIkpO9yvjDfzf-OKOyFr_FNrVi5YAxlBTPFax1Mybv0b_1Ew00qYvZZUcXEyI/exec';

    const thaiMonths = {
      "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°": 0, "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå": 1, "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°": 2, "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô": 3,
      "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°": 4, "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô": 5, "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°": 6, "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°": 7,
      "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô": 8, "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°": 9, "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô": 10, "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°": 11
    };

    let currentData = [];
    let monthAsc = true;

    function formatDateString(entry) {
      return `${entry["‡∏ß‡∏±‡∏ô"]} ${entry["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]} ${entry["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]} ${entry["‡∏õ‡∏µ"]} ${entry["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"]} - ${entry["‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"] || ""}`;
    }

    function renderTable(data) {
      const table = document.getElementById('data-table');
      table.innerHTML = '';
    
      if (!data || data.length === 0) {
        table.innerHTML = '<tr><td>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        return;
      }
    
      const headers = Object.keys(data[0])
        .filter(k => k && !["‡∏õ‡∏µ", "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏ß‡∏±‡∏ô", "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°", "‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"].includes(k));
    
      const headerRow = document.createElement('tr');
      headerRow.innerHTML = `<th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>` + headers.map(h => `<th>${h}</th>`).join('');
      table.appendChild(headerRow);
    
      data.forEach(entry => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${formatDateString(entry)}</td>` +
          headers.map(h => `<td>${(entry[h] || '').toString().replace(/\n/g, '<br>')}</td>`).join('');
        table.appendChild(row);
      });
    
      // üü¢ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á scroll-sync ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      const sync = document.querySelector('.scroll-sync');
      sync.style.width = table.scrollWidth + 'px';
    }

    function sortByMonth(data, ascending = true) {
      return [...data].sort((a, b) => {
        const ma = thaiMonths[a["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]], mb = thaiMonths[b["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]];
        if (ma !== mb) return ascending ? ma - mb : mb - ma;

        const da = parseInt(a["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]), db = parseInt(b["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]);
        if (da !== db) return ascending ? da - db : db - da;

        const [ha, ma_ = 0] = (a["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"] || "00:00").split(":").map(Number);
        const [hb, mb_ = 0] = (b["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"] || "00:00").split(":").map(Number);
        return ascending
          ? (ha * 60 + ma_) - (hb * 60 + mb_)
          : (hb * 60 + mb_) - (ha * 60 + ma_);
      });
    }

    function fetchData(type) {
      fetch(apiUrl)
        .then(res => res.json())
        .then(json => {
          const raw = json[type] || [];
          currentData = sortByMonth(raw, monthAsc);
          renderTable(currentData);
        })
        .catch(err => {
          document.getElementById('data-table').innerHTML = `<tr><td>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
          console.error(err);
        });
    }

    document.getElementById('type').addEventListener('change', e => {
      fetchData(e.target.value);
    });

    document.getElementById('sortByMonth').addEventListener('click', () => {
      monthAsc = !monthAsc;
      currentData = sortByMonth(currentData, monthAsc);
      renderTable(currentData);
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    fetchData(document.getElementById('type').value);
  </script>
    <script>
        window.onload = function() {
            setTimeout(() => {
                document.getElementById("loader").classList.add("hide");
            }, 1500);
        };
        function toggleMenu() {
            const menu = document.querySelector(".nav-menu");
            const burger = document.querySelector(".hamburger");
            menu.classList.toggle("show");
            burger.textContent = menu.classList.contains("show") ? "‚úñ" : "‚ò∞";
        }
    </script>
</body>
</html>
