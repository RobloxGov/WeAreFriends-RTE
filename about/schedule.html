<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Kanit', sans-serif;
      }
      select, table {
        margin-top: 20px;
        font-size: 16px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
</head>
<body>
      <h1>üìò ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö</h1>
      <label for="type">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</label>
      <select id="type">
        <option value="‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1/2568">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
        <option value="‡∏™‡∏≠‡∏ö 1/2568">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ö</option>
      </select>
    
      <table id="data-table"></table>
    
      <script>
        const apiUrl = 'https://script.google.com/macros/s/AKfycbzOY_kwIkpO9yvjDfzf-OKOyFr_FNrVi5YAxlBTPFax1Mybv0b_1Ew00qYvZZUcXEyI/exec';
    
        const thaiMonths = {
          "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°": 0, "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå": 1, "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°": 2, "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô": 3,
          "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°": 4, "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô": 5, "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°": 6, "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°": 7,
          "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô": 8, "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°": 9, "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô": 10, "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°": 11
        };
    
        function toSortableDate(entry) {
          if (entry["‡∏õ‡∏µ"] && entry["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"] && entry["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"] && entry["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"]) {
            const year = parseInt(entry["‡∏õ‡∏µ"]) - 543;
            const month = thaiMonths[entry["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]];
            const day = parseInt(entry["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]);
            const [hour, minute] = entry["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"].split(":").map(Number);
            return new Date(year, month, day, hour, minute);
          }
          return new Date(9999, 0, 1); // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        }
    
        function formatDateString(entry) {
          return `${entry["‡∏ß‡∏±‡∏ô"]} ${entry["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]} ${entry["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]} ${entry["‡∏õ‡∏µ"]} ${entry["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"]} - ${entry["‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"]}`;
        }
    
        function renderTable(data) {
          const table = document.getElementById('data-table');
          table.innerHTML = '';
    
          if (!data || data.length === 0) {
            table.innerHTML = '<tr><td>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            return;
          }
    
          // ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
          const headers = Object.keys(data[0]).filter(k => k && k !== "‡∏õ‡∏µ" && k !== "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" && k !== "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" && k !== "‡∏ß‡∏±‡∏ô" && k !== "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°" && k !== "‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î");
          const headerRow = document.createElement('tr');
          headerRow.innerHTML = `<th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>` + headers.map(h => `<th>${h}</th>`).join('');
          table.appendChild(headerRow);
    
          // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          data.forEach(entry => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${formatDateString(entry)}</td>` +
              headers.map(h => `<td>${(entry[h] || '').toString().replace(/\n/g, '<br>')}</td>`).join('');
            table.appendChild(row);
          });
        }
    
        function fetchData(type) {
          fetch(apiUrl)
            .then(res => res.json())
            .then(json => {
              const raw = json[type] || [];
              const sorted = raw.sort((a, b) => toSortableDate(a) - toSortableDate(b));
              renderTable(sorted);
            })
            .catch(err => {
              document.getElementById('data-table').innerHTML = `<tr><td>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
              console.error(err);
            });
        }
    
        document.getElementById('type').addEventListener('change', e => {
          fetchData(e.target.value);
        });
    
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        fetchData(document.getElementById('type').value);
      </script>
</body>
</html>
