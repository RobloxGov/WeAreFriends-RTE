<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Kanit', sans-serif;
      }
        
      select, table {
        margin-top: 20px;
        font-size: 16px;
      }
        
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #ffd8bf;
      }
    </style>
</head>
<body>
  <h1>üìò ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ö</h1>

  <label for="type">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</label>
  <select id="type">
    <option value="‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 1/2568">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
    <option value="‡∏™‡∏≠‡∏ö 1/2568">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≠‡∏ö</option>
  </select>

  <button id="sortByMonth">üîÅ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>

  <table id="data-table"></table>

  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzOY_kwIkpO9yvjDfzf-OKOyFr_FNrVi5YAxlBTPFax1Mybv0b_1Ew00qYvZZUcXEyI/exec';

    const thaiMonths = {
      "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°": 0, "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå": 1, "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°": 2, "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô": 3,
      "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°": 4, "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô": 5, "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°": 6, "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°": 7,
      "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô": 8, "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°": 9, "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô": 10, "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°": 11
    };

    let currentData = [];
    let monthAsc = true;

    function formatDateString(entry) {
      return `${entry["‡∏ß‡∏±‡∏ô"]} ${entry["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]} ${entry["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]} ${entry["‡∏õ‡∏µ"]} ${entry["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"]} - ${entry["‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"] || ""}`;
    }

    function renderTable(data) {
      const table = document.getElementById('data-table');
      table.innerHTML = '';

      if (!data || data.length === 0) {
        table.innerHTML = '<tr><td>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        return;
      }

      const headers = Object.keys(data[0])
        .filter(k => k && !["‡∏õ‡∏µ", "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", "‡∏ß‡∏±‡∏ô", "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°", "‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"].includes(k));

      const headerRow = document.createElement('tr');
      headerRow.innerHTML = `<th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>` + headers.map(h => `<th>${h}</th>`).join('');
      table.appendChild(headerRow);

      data.forEach(entry => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${formatDateString(entry)}</td>` +
          headers.map(h => `<td>${(entry[h] || '').toString().replace(/\n/g, '<br>')}</td>`).join('');
        table.appendChild(row);
      });
    }

    function sortByMonth(data, ascending = true) {
      return [...data].sort((a, b) => {
        const ma = thaiMonths[a["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]], mb = thaiMonths[b["‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"]];
        if (ma !== mb) return ascending ? ma - mb : mb - ma;

        const da = parseInt(a["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]), db = parseInt(b["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]);
        if (da !== db) return ascending ? da - db : db - da;

        const [ha, ma_ = 0] = (a["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"] || "00:00").split(":").map(Number);
        const [hb, mb_ = 0] = (b["‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°"] || "00:00").split(":").map(Number);
        return ascending
          ? (ha * 60 + ma_) - (hb * 60 + mb_)
          : (hb * 60 + mb_) - (ha * 60 + ma_);
      });
    }

    function fetchData(type) {
      fetch(apiUrl)
        .then(res => res.json())
        .then(json => {
          const raw = json[type] || [];
          currentData = sortByMonth(raw, monthAsc);
          renderTable(currentData);
        })
        .catch(err => {
          document.getElementById('data-table').innerHTML = `<tr><td>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
          console.error(err);
        });
    }

    document.getElementById('type').addEventListener('change', e => {
      fetchData(e.target.value);
    });

    document.getElementById('sortByMonth').addEventListener('click', () => {
      monthAsc = !monthAsc;
      currentData = sortByMonth(currentData, monthAsc);
      renderTable(currentData);
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    fetchData(document.getElementById('type').value);
  </script>
</body>
</html>
